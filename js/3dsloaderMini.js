function getBinary(d){var e=new XMLHttpRequest;e.open("GET",d,!1);e.overrideMimeType("text/plain; charset=x-user-defined");e.send(null);return e.responseText}function decodeFloat(d,e,j,a,c,g,f){for(var b="",h=0,n=d.length;h<n;h++){for(var m=d[h].toString(2);8>m.length;)m="0"+m;b=f?m+b:b+m}d="1"==b.charAt(0)?-1:1;f=parseInt(b.substr(e,j),2)-g;e=b.substr(e+j,a);j="1"+e;h=0;a=1;b=0;if(f==-g){if(-1==e.indexOf("1"))return 0;f=c;j="0"+e}for(;h<j.length;)b+=a*parseInt(j.charAt(h)),a/=2,h++;return d*b*Math.pow(2,f)}function Mesh(d){this.name=d;this.vertices=[];this.normals=[];this.uvs=[];this.flags=[];this.indices=[];this.materialName=""}function Subt(d,e,j){d[0]=e[0]-j[0];d[1]=e[1]-j[1];d[2]=e[2]-j[2]}function Cross(d,e,j){d[0]=e[1]*j[2]-e[2]*j[1];d[1]=e[2]*j[0]-e[0]*j[2];d[2]=e[0]*j[1]-e[1]*j[0]}function Dot(d,e){return d[0]*e[0]+d[1]*e[1]+d[2]*e[2]}function Normalize(d){var e=Math.sqrt(Dot(d,d));0!=e&&(e=1/e,d[0]*=e,d[1]*=e,d[2]*=e)}function getNormal(d,e,j){var a=[],c=[],g=[];Subt(a,d,e);Subt(c,d,j);Cross(g,a,c);Normalize(g);return g}function load3DS(){var d=(new Date).getTime(),e=(new Date).getTime()-d,j=byteArray.length;console.log("Length: "+j);for(var a=0,d=(new Date).getTime(),c=void 0;a<j;){var g=byteArray[a+1]<<8|byteArray[a],f=byteArray[a+5]<<24|byteArray[a+4]<<16|byteArray[a+3]<<8|byteArray[a+2],a=a+6;switch(g){case 19789:break;case 15677:break;case 16384:var g=0,b=f="";do b=String.fromCharCode(byteArray[a++]),f+=b,g++;while("\x00"!=b&&20>g);console.log("Object name: "+f);meshes.push(new Mesh(f));c=meshes[meshes.length-1];break;case 16640:break;case 16656:g=byteArray[a++];f=byteArray[a++];f=f<<8|g;console.log("Total vertices: "+f);c.normals=newFilledArray(3*f,0);for(g=0;g<f;g++){var b=byteArray[a++],h=byteArray[a++],n=byteArray[a++],m=byteArray[a++],b=[b,h,n,m],k=decodeFloat(b,1,8,23,-126,127,!0),b=byteArray[a++],h=byteArray[a++],n=byteArray[a++],m=byteArray[a++],b=[b,h,n,m],l=decodeFloat(b,1,8,23,-126,127,!0),b=byteArray[a++],h=byteArray[a++],n=byteArray[a++],m=byteArray[a++],b=[b,h,n,m],b=decodeFloat(b,1,8,23,-126,127,!0);c.vertices.push(k);c.vertices.push(l);c.vertices.push(b)}break;case 16672:g=byteArray[a++];f=byteArray[a++];f=f<<8|g;console.log("Total polygons: "+f);for(g=0;g<f;g++)b=byteArray[a++],h=byteArray[a++],l=h<<8|b,c.indices.push(l),b=byteArray[a++],h=byteArray[a++],k=h<<8|b,c.indices.push(k),b=byteArray[a++],h=byteArray[a++],b|=h<<8,c.indices.push(b),h=3*l,k*=3,b*=3,l=getNormal([c.vertices[h],c.vertices[h+1],c.vertices[h+2]],[c.vertices[k],c.vertices[k+1],c.vertices[k+2]],[c.vertices[b],c.vertices[b+1],c.vertices[b+2]]),c.normals[h]+=l[0],c.normals[h+1]+=l[1],c.normals[h+2]+=l[2],c.normals[k]+=l[0],c.normals[k+1]+=l[1],c.normals[k+2]+=l[2],c.normals[b]+=l[0],c.normals[b+1]+=l[1],c.normals[b+2]+=l[2],b=byteArray[a++],h=byteArray[a++],c.flags.push(h<<8|b);break;case 16704:g=byteArray[a++];f=byteArray[a++];f=f<<8|g;console.log("Total uvs: "+f);for(g=0;g<f;g++)a++,a++,a++,a++,a++,a++,a++,a++;break;case 45055:break;case 40960:g=0;f="";do b=String.fromCharCode(byteArray[a++]),f+=b,g++;while("\x00"!=b&&20>g);console.log("Material Name: "+f);meshes.push(new Mesh(f));c=meshes[meshes.length-1];c.materailName=f;break;case 41728:g=0;f="";do b=String.fromCharCode(byteArray[a++]),f+=b,g++;while("\x00"!=b&&20>g);console.log("Texture filename: "+f);break;case 41472:case 41786:case 41488:case 41520:case 41788:case 41476:case 41789:case 41504:case 41790:case 41792:case 41794:case 41796:case 41798:case 41800:case 41802:case 41804:break;default:a+=parseInt(f-6)}}d=(new Date).getTime()-d;console.log("3ds file ["+filename+"] loaded in "+e+" millisecs.");console.log("\tParsing time: "+d+" millisecs.");d=(new Date).getTime();console.log("Generating normals ...");console.log("\tNormals generated in "+((new Date).getTime()-d)+" millisecs.")}function newFilledArray(d,e){for(var j=[],a=0;a<d;)j[a++]=e;return j};